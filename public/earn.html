<!-- Delux Earning – Auto Tasks with YouTube API -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Delux Earning</title>
  <script src="https://www.youtube.com/iframe_api"></script>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;max-width:640px;margin:auto;padding:1rem;text-align:center}
    .hidden{display:none}
    button{padding:.6rem 1.2rem;font-size:1rem;border:none;border-radius:8px;cursor:pointer;background:#28a745;color:#fff}
    input{padding:.5rem;font-size:1rem;width:80%;border-radius:5px;border:1px solid #ccc}
  </style>
</head>
<body>
  <h1>Delux Earning Tasks</h1>
  <h2 id="task-title">Loading…</h2>
  <p>Reward: <strong id="reward-amount"></strong></p>

  <!-- Video -->
  <div id="video-wrapper" class="hidden"><div id="yt-player"></div></div>

  <!-- Music -->
  <div id="audio-wrapper" class="hidden">
    <iframe id="yt-audio" width="100%" height="170" frameborder="0" allow="autoplay" allowfullscreen></iframe>
  </div>

  <!-- Claim -->
  <div id="claim-section" class="hidden">
    <p>Enter your Delux name to claim:</p>
    <input id="user-name" placeholder="Delux username"/>
    <br><br><button onclick="claimReward()">Claim Reward</button>
  </div>

  <br><button onclick="nextTask()">Skip & Next Task</button>

<script>
/* ---------- CONFIG ---------- */
const API_KEY = "AIzaSyBQ37WSC-Rsxt3nK1KPj8LiPv7Ua7Ezao8";
const PAY_MIN = 50, PAY_MAX = 300;
const VIDEO_TERMS = ["how to", "funny", "travel", "tech review", "vlog", "sports highlights"];
const MUSIC_TERMS = ["lofi", "jazz mix", "pop hits", "edm", "classical", "hip hop"];

/* ---------- STATE ---------- */
let player, watchTimer, watchStarted=false;
let currentTask;

/* ---------- HELPERS ---------- */
const $ = id=>document.getElementById(id);
const rnd = (min,max)=>Math.floor(Math.random()*(max-min+1))+min;
const pick = list=>list[Math.floor(Math.random()*list.length)];

/* Search YouTube (video or music) */
async function ytSearch(term){
  const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=15&type=video&q=${encodeURIComponent(term)}&key=${API_KEY}`;
  const j   = await (await fetch(url)).json();
  return j.items.filter(i=>i.id && i.id.videoId);
}

/* ---------- TASK FLOW ---------- */
async function nextTask(){
  clearTimeout(watchTimer); watchStarted=false;
  $("claim-section").classList.add("hidden");

  const isVideo = Math.random()<0.5;
  const term    = pick(isVideo?VIDEO_TERMS:MUSIC_TERMS);
  const results = await ytSearch(term);
  const chosen  = pick(results);

  currentTask = {
    type:  isVideo?"video":"music",
    id:    chosen.id.videoId,
    title: chosen.snippet.title,
    amount:rnd(PAY_MIN,PAY_MAX)
  };

  $("task-title").textContent = currentTask.title;
  $("reward-amount").textContent = `€${currentTask.amount}`;

  if(isVideo){
    $("audio-wrapper").classList.add("hidden");
    $("video-wrapper").classList.remove("hidden");

    if(player) player.loadVideoById(currentTask.id);
    else player = new YT.Player("yt-player",{
      height:"315",width:"560",videoId:currentTask.id,
      events:{onStateChange:e=>{
        if(e.data===YT.PlayerState.PLAYING&&!watchStarted){
          watchStarted=true;
          const dur = player.getDuration();
          watchTimer=setTimeout(showClaim,dur*1000);
        }
      }}
    });
  }else{
    $("video-wrapper").classList.add("hidden");
    $("audio-wrapper").classList.remove("hidden");
    const ifr=$("yt-audio");
    ifr.src=`https://www.youtube.com/embed/${currentTask.id}?autoplay=1`;
    watchTimer=setTimeout(showClaim,91000); // ~91 seconds
  }
}

function showClaim(){ $("claim-section").classList.remove("hidden"); }

function claimReward(){
  const name=$("user-name").value.trim();
  if(!name) return alert("Please enter your Delux name.");
  const msg=encodeURIComponent(`Hi @Deluxcashearning, I just completed a task and want to claim €${currentTask.amount}. My Delux name: ${name}.`);
  window.open(`https://t.me/share/url?url=&text=${msg}`);
  $("claim-section").classList.add("hidden");
}

window.onload=nextTask;
</script>
</body>
</html>